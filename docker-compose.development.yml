# Please refer https://aka.ms/HTTPSinContainer on how to setup an https developer certificate for your ASP .NET Core service.

version: '3.4'

services:
  api:
    image: lofi/api
    build:
      context: Lofi.API
      dockerfile: Dockerfile.development
    ports:
      - 8010:80
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_URLS=http://+:80
    volumes:
      - ~/.vsdbg:/remote_debugger:rw
      - ~/.aspnet/https:/https:ro
      - ./Lofi.API:/home/app/src
      - "${MUSIC_DIRECTORY:-~/music}:/music"
    depends_on:
      - db
  app:
    image: lofi/app
    build:
      context: Lofi.App
      dockerfile: Dockerfile.development
    ports:
      - 8020:80
    environment:
      - ROLLUP_WATCH=1
    volumes:
      - ./Lofi.App:/src
    depends_on:
      - api
  nginx:
    image: lofi/nginx
    build:
      context: Lofi.Nginx
      dockerfile: Dockerfile.development
    ports:
      - 80:80
    volumes:
      - "./Lofi.Nginx/nginx.development.conf:/etc/nginx/nginx.conf"
      - "${MUSIC_DIRECTORY:-~/music}:/var/www/lofi/media"
  db:
    image: postgres
    restart: always
    ports:
      - "5432:5432"
    environment:
      POSTGRES_USER: "lofiuser"
      POSTGRES_PASSWORD: "lofiuser"
      POSTGRES_DB: "lofi"
    volumes:
      - "${PG_DATA_DIR:-~/pg}:/var/lib/postgresql/data"
  adminer:
    image: adminer
    restart: always
    ports:
      - 8030:8080
    depends_on:
      - db
  monerod:
    image: xmrto/monero:v0.17.2.0
    command: --testnet --data-dir /monero
    volumes:
      - "${MONEROD_DATA_DIR:-~/.bitmonero}:/monero"
    ports:
      - 28080:28080
      - 28081:28081
    restart: unless-stopped
  monero-wallet-rpc:
    image: xmrto/monero:v0.17.2.0
    command: monero-wallet-rpc --testnet --disable-rpc-login --wallet-dir /monero/wallets
    volumes:
      - "${MONEROD_DATA_DIR:-~/.bitmonero}:/monero"
    environment:
      - DAEMON_HOST=monerod
      - DAEMON_PORT=28081
      - RPC_BIND_PORT=28083
    ports:
      - 28083:28083
    restart: unless-stopped
    depends_on:
      - monerod

